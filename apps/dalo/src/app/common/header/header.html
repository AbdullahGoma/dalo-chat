<header
  class="h-9 bg-background rounded-3 border border-border shadow-sm flex items-center justify-between p-7 my-2 sticky top-0 z-50"
>
  <!-- Left: Dalo Chat -->
  <h1 class="text-base font-bold text-foreground font-logo">Dalo Chat</h1>

  <!-- Right: Icons -->
  <div class="flex items-center gap-3">
    <!-- Theme Toggle -->
    <button
      (click)="onToggleTheme()"
      class="w-8 h-8 rounded-full bg-surface hover:bg-surface/50 flex items-center justify-center transition-colors duration-200 focus:outline-none focus:ring-1 focus:ring-foreground cursor-pointer"
      title="Toggle theme"
    >
      @if (themeService.isDarkMode()) {
      <svg
        class="w-8 h-8 scale-150 text-foreground"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="3"
          d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
        />
      </svg>
      } @else {
      <svg
        class="w-4 h-4 scale-125 text-foreground"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="3"
          d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
        />
      </svg>
      }
    </button>

    <!-- Add Chat -->
    <button
      (click)="onCreateChat()"
      class="w-8 h-8 rounded-full bg-accent hover:bg-accent/80 text-background flex items-center justify-center transition-colors duration-200 focus:outline-none focus:ring-1 focus:ring-accent disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"
      [disabled]="chats().length >= 5"
      title="New chat"
    >
      <svg
        class="w-8 h-8 scale-150 text-background"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 4v16m8-8H4"
        />
      </svg>
    </button>

    <!-- All Chats Dropdown -->
    <div class="relative">
      <div
        class="w-8 h-8 rounded-full bg-surface hover:bg-surface/50 flex items-center justify-center transition-colors duration-200 cursor-pointer"
        [libHoverDropdown]="chatDropdownTpl"
        title="All chats"
      >
        <svg
          class="w-6 h-6 text-foreground"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
          />
        </svg>
      </div>

      <ng-template #chatDropdownTpl>
        <div
          class="absolute top-full right-1 mt-3 w-max bg-background rounded-3 shadow-xl border border-border overflow-hidden"
        >
          @if (chats().length > 0) {
          <div class="px-2 py-1 border-b border-border">
            <h3 class="font-bold text-foreground text-base">All Chats</h3>
          </div>
          <div>
            @for (chat of chats(); track chat.id) {
            <div
              class="flex items-center gap-2 px-2 py-1 hover:bg-hover cursor-pointer border-b border-border last:border-b-0"
              [class.bg-hover]="selectedChatId() === chat.id"
              [class.bg-hover]="selectedChatId() === chat.id"
              (click)="onSelectChat(chat.id)"
              tabindex="0"
              role="button"
              (keydown.enter)="onSelectChat(chat.id)"
              (keydown.space)="onSelectChat(chat.id)"
            >
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-foreground truncate">
                  {{ chat.title }}
                </p>
                <p class="text-nano text-muted">
                  {{ chat.updatedAt | date: 'short' }}
                </p>
              </div>
              @if (selectedChatId() === chat.id) {
              <div class="w-2 h-2 rounded-full bg-hover"></div>
              }

              <!-- Delete button -->
              <button
                class="border-none bg-transparent p-1 rounded-full hover:bg-destructive/20 transition-colors duration-200 flex items-center justify-center focus:outline-none focus:ring-1 focus:ring-red-500 cursor-pointer"
                (click)="onDeleteChat(chat.id, $event)"
                title="Delete chat"
                type="button"
              >
                <svg
                  class="w-6 h-6 text-destructive fill-current"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 640 640"
                >
                  <path
                    d="M232.7 69.9L224 96L128 96C110.3 96 96 110.3 96 128C96 145.7 110.3 160 128 160L512 160C529.7 160 544 145.7 544 128C544 110.3 529.7 96 512 96L416 96L407.3 69.9C402.9 56.8 390.7 48 376.9 48L263.1 48C249.3 48 237.1 56.8 232.7 69.9zM512 208L128 208L149.1 531.1C150.7 556.4 171.7 576 197 576L443 576C468.3 576 489.3 556.4 490.9 531.1L512 208z"
                  />
                </svg>
              </button>
            </div>
            }
          </div>
          } @else {
          <div class="p-4 text-center text-muted">
            <p>No chats yet</p>
          </div>
          }
        </div>
      </ng-template>
    </div>
  </div>
</header>
